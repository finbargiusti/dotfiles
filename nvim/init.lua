--[[
            |\     /|\__   __// ___   )(  ___  )(  ____ )(  __  \ 
            | )   ( |   ) (   \/   )  || (   ) || (    )|| (  \  )
            | | _ | |   | |       /   )| (___) || (____)|| |   ) |
            | |( )| |   | |      /   / |  ___  ||     __)| |   | |
            | || || |   | |     /   /  | (   ) || (\ (   | |   ) |
            | () () |___) (___ /   (_/\| )   ( || ) \ \__| (__/  )
            (_______)\_______/(_______/|/     \||/   \__/(______/ 
            _______  _______  _        _______ _________ _______ 
            (  ____ \(  ___  )( (    /|(  ____ \\__   __/(  ____ \
            | (    \/| (   ) ||  \  ( || (    \/   ) (   | (    \/
            | |      | |   | ||   \ | || (__       | |   | |      
            | |      | |   | || (\ \) ||  __)      | |   | | ____ 
            | |      | |   | || | \   || (         | |   | | \_  )
            | (____/\| (___) || )  \  || )      ___) (___| (___) |
            (_______/(_______)|/    )_)|/       \_______/(_______)

            Finbar Giusti
                                          __                                    
                                       _,Φ▓▓▓▓K▄,_   _                          
                                     _╓▓╣▓██████▀▌K≈`                           
                                   _!╟╬╣▓▓█████É                                
                                ,K╓Φ╬╣▓███████▓%                                
                                ╔▓▓╣▓██████████W_                               
                               ▒▄▓▓▓▓▓████████▌Ñ⌐                               
                            ╓▓▓▓▓╬╬▓▓▓▓█████████,┐                              
                           ^╚0╬╬╬╬╬╬╣▓╬▓█████████▌_                             
                          ,╦╬╣▓▓▓████████████████╬%                             
                      ,▄φ▓████╬▓╩╝╩Ö╠╠╠╠╩╩╣████████▒                            
                 _▄▄▓██████▓█╫^~,_ j r/`╓/S╚╢▓█████▓N_                          
              ¿▄▓██████████╟▀P╚▓▓▄╔▓∩$╔▄A¼▓█▓▒╟██████▓▄_                        
             ╔███████████▓▄▄█φ╣████Ñ╫╫╣█▒╣█████╠▓▓██████▓╦ç__                   
            _████████████Ñ╫▓████████ :▓████████Ñ██╠▓████████▓▄>_                
            ╙╬██████████"╬██╙█████▓▌ ]╫▓██████▒,▓██Å╬╫██████████▄               
             `╠████████╔Ñ███▌╫ ``╟,   ╠,█▄└╙╙╠▓▓╣▓██▓Ñ╣██████████P              
                ╙█████▌"╣╬██╠▒▌_Ö=╝▀▓▓▓▓Ñ╝╬▄╫█╣╬╣███╣▒'╣████████R               
                   "▀▀█▒╬▓▌▒K▓╬╜_╓▄▄╬╬▓▄▄▄▄▀▀╝▓▓╬╬╟██▒┌▓╬████╝╙                 
                       ╠╟▌─p╢▓▓▓█▓▒╦╗φ╗▄╠╬╣█▓▓▓╫╬╬╣╫█╬▓╬╙^`                     
                   µ▒⌂_Ñ▓K└»â╩╫▓╨]╙`^"╙╚╚╚╬╬▓╬╬╣╬╬╠Ñ▓█▓Ü_                       
                 ▄▓▀╙▓╟╣Ñ». ,^A∩/¡     \!]╣╣▓╝NÖÜÖ╬╬╬█▓▓▓▓▄▄   _                
               _╬▌ⁿ▓▓▓▌╫╓Ü,óφ░ê ¿~_┐_|_LV╠╙╬ÖÑÜ╙╫╣▒╫╟╬█████▓▓██▓▓_              
              ⁿÅ█████╟▓Ü╬ÄM▀H╬▐|▒▒[░#╠ÜΦ╟╫▒╬²▒╬▌╠▓▌╟╬╬Ñ████████▓╬B`             
              ,▓▓▓████▀^▄┴Φ▄╓│╙É╠T╠▓φφφ╗▄▄`"╚▌╠╣▒▓╣▄██╬╣███████▓ ╙              
             :╣▓▓▓▓▀^Γ`_,▄,_¬`║▀████╣φ╦╦_ ╙▀█▄`╙Ü╬╫╬▓▓█╟███▓╬▓██▓               
             ▐▓▓██▌░,≡╬▓█Ñ╣██▄w▒▓██▓╬╬╬▒░____╠██ ╚Ñ▓▓██████╣╬▓▓██▓              
            y▓▓███'`»___,░_ ╙██████▓▓╬╬╬▒▒▒╠╬▓╬██▄'▓╬╣████▓█▓▓▓▓█▓▓             
           ╓▓▓▓██ _░╓▄╣█╓██▄_j╙█████▓▓▓▓▓╣╣▓▓▓█▓██▄'▓▓████▓██▓▓▓▓██▓_           
         _▄▓▓███▌`_ └╙▀▀█████▄▄▓████████▓▓▓████████▌╟█████▓██▓╬▓▓███▓           
        _╬▓█████_░ú^╙╝K#W▄╓╙███████████████████_²╙╢▀"▀▀██████████████▓          
      ,╔▓█▓Ñ▓██M░░__╓╓╓╓,_╙▓▒▓███▓▓╬╬╬╬╬╣▓▓█████▄╥░,░▒ _╙███████████▓╬▒         
     ,ó╬╬╟Ñ▓█Ñ╡░░ `1╬██╟█▓▒Ü╟▓╬▓╬╬╬╩╚╚╚╚╠╬╬╣▓███████╟▓▄░=▀███▓▀█████▓╬Ñ7u_      
    A╓▓Ñ▓Ñ▓█▌░░░░_░░╠██▌╚╫█▓▓╬╬╬╩ÜÜ»```»░╚╠╬╣▓█▓███É█▓▀╜»░░▒╚██▓╬▓╬▓╬▀▓▓╗^\     
   ╩╔▓Ñ▓█╣▓██W╬▓▓▓▓█████▌ ╙╣█▓▄```      `»╚╠╩╟▓███`▀` _:Ä░░M_|██▓▌╟█╬█▓╬╚╣▄     
   ¢▓▌▓█╬█╣██▓████████████_ ╙╚╬╠▒=__     ╔╗▓▓▓▓▓▀X▀``,╓╠╬╬▄φφ╠▓█╬█▓╫█▓███▓╬▓    
 !_▓█▓██╣███████████████████▄`-"Ü░       `+╠╠╙╠⌐"``,╦╠╬▓▓██▓▓████▓█▌███████▓▓   
 :▐▓████╣█████████████████████▀π╥▄.─⌐⌐────e"│»_,╓▄╬╫▓████████████████████████▓  
_,[▓████╣█████████████████████▓▄▓V▄▄▄▄▄╦▄▄▄▄▄▓▓╬╬╠╬███████████████████████████  
░⌠╚▓█████████████████████████████▄▓▓▓██▓█████╣████████████████████████████████  
▒▒Ü▓███████████████████████████████████╬██▓██▓████████████████████████████████ _
▒▒╬╣███████████████████████████╣████╣██╬██▓██▓███████████████████████████████M╠▒

  This config is mostly based on [kickstart.nvim](https://github.com/nvim-lua/kickstart.nvim)
]] --

-- Pull youself up by your boostraps
local lazypath = vim.fn.stdpath 'data' .. '/lazy/lazy.nvim'
if not vim.loop.fs_stat(lazypath) then
  vim.fn.system {
    'git',
    'clone',
    '--filter=blob:none',
    'https://github.com/folke/lazy.nvim.git',
    '--branch=stable', -- latest stable release
    lazypath,
  }
end
vim.opt.rtp:prepend(lazypath)

-- Set leader and localleader before loading plugins
vim.g.mapleader = ' '
vim.g.maplocalleader = ' '

-- Pull plugins
require('lazy').setup(require('plugins'), {})

-- custom commands
require('commands')
-- general / small keybinds
require('keybinds')
-- vim settings
require('settings')

require('configs.telescope')
require('configs.nvim-treesitter')

-- Diagnostic keymaps
vim.keymap.set('n', '[d', vim.diagnostic.goto_prev)
vim.keymap.set('n', ']d', vim.diagnostic.goto_next)
vim.keymap.set('n', '<leader>e', vim.diagnostic.open_float)
vim.keymap.set('n', '<leader>q', vim.diagnostic.setloclist)

vim.keymap.set('n', '<leader>gg', function() vim.cmd([[LazyGit]]) end)

-- Enable the following language servers
--  Feel free to add/remove any LSPs that you want here. They will automatically be installed.
--
--  Add any additional override configuration in the following tables. They will be passed to
--  the `settings` field of the server config. You must look up that documentation yourself.
local servers = {
  -- clangd = {},
  -- gopls = {},
  -- pyright = {},
  -- rust_analyzer = {},
  -- tsserver = {},

  lua_ls = {
    Lua = {
      workspace = { checkThirdParty = false },
      telemetry = { enable = false },
    },
  },
}

-- Setup neovim lua configuration
require('neodev').setup()

-- nvim-cmp supports additional completion capabilities, so broadcast that to servers
local capabilities = vim.lsp.protocol.make_client_capabilities()
capabilities = require('cmp_nvim_lsp').default_capabilities(capabilities)

-- require('java').setup()

-- Setup mason so it can manage external tooling
require('mason').setup()

-- Ensure the servers above are installed
local mason_lspconfig = require 'mason-lspconfig'

mason_lspconfig.setup {
  ensure_installed = vim.tbl_keys(servers),
  automatic_installation = true
}

mason_lspconfig.setup_handlers {
  function(server_name)
    require('lspconfig')[server_name].setup {
      capabilities = capabilities,
      on_attach = require('lspbindings'),
      settings = servers[server_name],
    }
  end,
  ['jdtls'] = function() end
}

require 'lspconfig'.metals.setup {}

-- nvim-cmp setup
local cmp = require 'cmp'
local luasnip = require 'luasnip'

luasnip.config.setup {}

cmp.setup {
  snippet = {
    expand = function(args)
      luasnip.lsp_expand(args.body)
    end,
  },
  mapping = cmp.mapping.preset.insert {
    ['<C-d>'] = cmp.mapping.scroll_docs( -4),
    ['<C-f>'] = cmp.mapping.scroll_docs(4),
    ['<C-Space>'] = cmp.mapping.complete {},
    ['<CR>'] = cmp.mapping.confirm {
      behavior = cmp.ConfirmBehavior.Replace,
      select = true,
    },
    ['<Down>'] = cmp.mapping(function(fallback)
      if cmp.visible() then
        cmp.select_next_item()
      elseif luasnip.expand_or_jumpable() then
        luasnip.expand_or_jump()
      else
        fallback()
      end
    end, { 'i', 's' }),
    ['<Up>'] = cmp.mapping(function(fallback)
      if cmp.visible() then
        cmp.select_prev_item()
      elseif luasnip.jumpable( -1) then
        luasnip.jump( -1)
      else
        fallback()
      end
    end, { 'i', 's' }),
  },
  sources = {
    { name = 'nvim_lsp' },
    { name = 'luasnip' },
  },
}

-- python setup
--
-- vim.g.python3_host_prog=vim.fn.expand("~/.virtualenvs/neovim/bin/python3")

-- The line beneath this is called `modeline`. See `:help modeline`
-- vim: ts=2 sts=2 sw=2 et

-- vim.cmd [[autocmd BufWritePre <buffer> lua vim.lsp.buf.formatting_sync()]]
-- or
-- vim.cmd [[autocmd autocmd BufWritePre * lua vim.lsp.buf.formatting_sync()]]

vim.opt.tabstop = 2
vim.opt.shiftwidth = 2
vim.opt.expandtab = true

-- vim.g['clang_format#auto_format'] = 1

-- vim.g['clang_format#style_options'] = {
--  ["TabWidth"] = 2,
--  ["IndentWidth"] = 2,
--}
--

-- add <leader>yy to copy the whole file

vim.keymap.set('n', '<leader>yy', function()
  vim.cmd([[ %y+ ]])
end)
  
